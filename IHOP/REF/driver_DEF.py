#!/usr/bin/env python2
# -*- coding: utf-8 -*-
"""
Created on 30 October 2020

@author: Fleur Couvreux
"""

## IHOP original case definition= a realistic convective boundary layer growth over Oklahoma
## Couvreux et al, QJRMS, 2005 Water-vapour variability within a convective boundary-layer assessed by
##large-eddy simulations and IHOP 2002 observations
## doi: 10.1256/qj.04.167

import os
import sys
sys.path = ['../../utils/',] + sys.path

import netCDF4 as nc
import numpy as np

import constants
from Case import Case

################################################
# 0. General configuration of the present script
################################################

lplot = True # plot all the variables
lverbose = False # print information about variables and case

################################################
# 1. General information about the case
################################################

case = Case('IHOP/REF',
        lat=36.56,
        lon=-100.61,
        startDate="200206140700",
        endDate="200206141400",
        zorog=0.,
        z0=0.1)

case.set_title("Forcing and initial conditions for IHOP case - Meso-NH definition")
case.set_reference("Couvreux et al. (2005, QJRMS)")
case.set_author("F. Couvreux")
case.set_script("DEPHY-SCM/IHOP/REF/driver_MESONH.py")


# time units are expected to be seconds since startDate
t0 = 0 # 12:00 UTC(=07:00LT), 14 June 2002
t1 = 25200 # 19:00 UTC(=14:00LT), 14 June 2002


################################################
# 2. Initial state
################################################

# Surface pressure
ps = 91800.
case.add_variable('ps',[ps,])
nz=100
z = np.zeros((nz),dtype=np.float64)
U = np.zeros((nz),dtype=np.float64)
V = np.zeros((nz),dtype=np.float64)
th = np.zeros((nz),dtype=np.float64)
rv = np.zeros((nz),dtype=np.float64)
z[:]=[0.0,76.0,124.0,174.0,225.0,274.0,325.0,375.0,425.0,475.0,525.0,574.0,624.0,674.0,725.0,774.0,825.0,874.0,925.0,974.0,1025.0,1075.0,1125.0,1175.0,1225.0,1275.0,1324.0,1374.0,1424.0,1474.0,1524.0,1575.0,1625.0,1675.0,1725.0,1774.0,1825.0,1874.0,1924.0,1974.0,2025.0,2075.0,2124.0,2176.0,2225.0,2275.0,2325.0,2375.0,2426.0,2475.0,2524.0,2575.0,2624.0,2675.0,2725.0,2775.0,2824.0,2875.0,2923.0,2974.0,3024.0,3075.0,3125.0,3176.0,3225.0,3275.0,3324.0,3375.0,3424.0,3475.0,3525.0,3574.0,3625.0,3675.0,3723.0,3774.0,3824.0,3873.0,3924.0,3974.0,4025.0,4075.0,4125.0,4175.0,4218.0,4274.9,4325.6,4374.5,4425.7,4474.9,4525.6,4574.5,4625.0,4674.5,4724.8,4774.9,4823.4,4874.5,4925.3,4974.5]
U[:]=[0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00,-0.50,-1.00,-1.50,-2.00,-2.00,-2.00,-2.20,-2.50,-2.70,-3.00,-3.00,-3.00,-3.00,-2.70,-2.50,-2.20,-1.50,-1.00,-0.70,-0.50,-0.20,0.00,0.20,0.50,0.70,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.50,2.00,2.50,3.00,3.00,3.50,4.00,5.00,6.00,7.00,8.00,9.00,9.50,10.00,11.00,12.00,13.00,14.00,15.00,15.50,16.00,16.50,17.00,17.50,18.00,18.20,18.50,18.70,19.00,19.50,20.00,20.00,20.00,20.00,20.00,20.00,19.50,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00,19.00]
V[:]=[0.00,-2.00,-1.50,-1.00,-0.50,-0.50,-1.00,-1.50,-2.00,-2.50,-3.00,-3.00,-3.00,-3.00,-3.50,-4.00,-4.00,-4.00,-4.00,-4.00,-4.00,-4.50,-5.00,-5.00,-5.00,-5.00,-4.50,-4.00,-4.00,-4.00,-3.50,-3.00,-3.00,-3.50,-4.00,-5.00,-5.80,-6.30,-7.00,-7.50,-8.00,-8.50,-9.00,-9.50,-10.00,-10.00,-10.00,-10.00,-10.20,-10.50,-10.70,-11.00,-11.50,-12.00,-11.50,-11.00,-10.50,-10.00,-10.00,-9.50,-9.00,-9.00,-8.50,-8.00,-8.00,-8.00,-8.00,-8.20,-8.50,-8.70,-9.00,-9.50,-10.00,-10.50,-11.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00,-12.00]
th[:]=[296.0,297.0,298.0,298.3,298.6,299.0,299.3,299.6,300.0,300.3,300.6,301.0,301.3,301.5,301.7,302.0,302.1,302.3,302.4,302.6,302.7,302.9,303.0,303.5,304.0,304.5,305.0,305.2,305.4,305.6,305.8,306.0,306.2,306.4,306.6,306.8,307.0,307.0,307.1,307.3,307.4,307.6,307.7,307.8,307.9,308.0,308.2,308.4,308.6,308.8,309.0,309.3,309.6,310.0,310.5,311.0,311.2,311.4,311.6,311.8,312.0,312.5,313.0,313.5,314.0,314.2,314.4,314.6,314.8,315.0,315.3,315.6,316.0,316.2,316.4,316.6,316.8,317.0,317.2,317.4,317.6,317.8,318.0,318.3,318.6,318.8,319.1,319.6,320.0,320.5,321.0,321.3,321.6,322.0,323.0,324.0,325.0,325.3,325.5,325.6]
rv[:]=[0.0112,0.0111,0.0110,0.0109,0.0108,0.0107,0.0105,0.0103,0.0100,0.0098,0.0096,0.0094,0.0091,0.0088,0.0085,0.0082,0.0079,0.0076,0.0073,0.0070,0.0067,0.0064,0.0061,0.0058,0.0055,0.0053,0.0051,0.0050,0.0050,0.0050,0.0049,0.0049,0.0049,0.0049,0.0049,0.0048,0.0048,0.0048,0.0048,0.0048,0.0048,0.0048,0.0048,0.0047,0.0047,0.0047,0.0047,0.0047,0.0047,0.0047,0.0046,0.0046,0.0046,0.0046,0.0046,0.0046,0.0046,0.0046,0.0046,0.0046,0.0046,0.0045,0.0045,0.0045,0.0045,0.0045,0.0045,0.0045,0.0045,0.0044,0.0043,0.0042,0.0041,0.0039,0.0037,0.0036,0.0035,0.0033,0.0031,0.0030,0.0030,0.0029,0.0028,0.0027,0.0025,0.0024,0.0023,0.0021,0.0017,0.0015,0.0015,0.0008,0.0002,0.0002,0.0002,0.0001,0.0001,0.0001,0.0001,0.0001]

case.add_variable('theta',th,lev=z,levtype='altitude')
case.add_variable('rv', rv,lev=z,levtype='altitude')

case.add_variable('u', U, lev=z,levtype='altitude')
case.add_variable('v', V, lev=z,levtype='altitude')

################################################
# 3. Forcing
################################################

# Nudging towards a given wind evolving with time
# Constant Geostrophic wind across the simulation
timeF= [0.,10800.,21600.]
ntf = len(timeF)
zforc = [16., 51.4, 86.9, 122.6, 158.4, 212.3, 284.7, 357.7, 431.2, 505.2, 579.9, 655.1, 769.0, 923.1, 1079.8, 1239.0, 1401.0, 1586.6, 1797.2, 2122.2, 2574.1, 3049.3, 3811.9, 4500.]
nzf = len(zforc)

ug = np.zeros((ntf,nzf),dtype=np.float64)
vg = np.zeros((ntf,nzf),dtype=np.float64)
w = np.zeros((ntf,nzf),dtype=np.float64)
thadv = np.zeros((ntf,nzf),dtype=np.float64)
rvadv = np.zeros((ntf,nzf),dtype=np.float64)
ug[0,:]=[-0.5,-0.6,-0.9,-1.1,-1.3,-1.5,-1.8,-2.2,-2.3,-2.2,-2.0,-1.8,-1.4,-0.9,-0.6,-0.5,-1.0,-1.9,-2.4,-1.3,2.3,6.2,12.1,19.0]
ug[1,:]=[-0.9,-0.9,-0.9,-0.9,-0.8,-0.8,-0.8,-0.8,-0.8,-0.8,-0.7,-0.5,-0.0,0.5,0.7,0.4,-0.1,0.1,0.9,2.3,5.0,7.3,12.1,17.0]
ug[2,:]=[-3.8,-3.8,-3.8,-3.8,-3.8,-3.7,-3.7,-3.6,-3.6,-3.5,-3.5,-3.4,-3.2,-2.9,-2.4,-1.5,-0.4,1.3,2.5,2.7,4.4,7.4,9.9,13.0]
vg[0,:]=[-2.6,-2.7,-2.8,-2.7,-2.7,-2.6,-2.4,-2.0,-1.6,-1.5,-1.5,-1.5,-1.9,-2.5,-3.2,-3.9,-4.4,-5.1,-5.8,-6.3,-7.5,-10.1,-12.7,-15.0]
vg[1,:]=[-2.3,-2.3,-2.3,-2.3,-2.3,-2.3,-2.3,-2.2,-2.2,-2.0,-1.8,-1.7,-1.5,-1.5,-1.4,-1.3,-1.6,-2.7,-4.1,-5.3,-6.7,-9.8,-11.5,-14.0]
vg[2,:]=[-0.8,-0.7,-0.7,-0.7,-0.7,-0.6,-0.6,-0.6,-0.5,-0.4,-0.4,-0.3,-0.2,0.1,0.4,0.9,1.5,1.0,-0.8,-2.8,-4.1,-5.8,-10.2,-14.0]
w[0,:]=[0.000,0.000,0.000,0.000,0.000,0.000,-0.005,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.005,0.000]
w[1,:]=[0.000,0.000,0.000,0.000,0.000,0.000,-0.000,-0.000,-0.000,-0.003,-0.006,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.005,0.000]
w[2,:]=[0.000,0.000,0.000,0.000,0.000,0.000,-0.000,-0.000,-0.000,-0.000,-0.001,-0.002,-0.004,-0.006,-0.008,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.010,-0.005,0.000]
thadv[0,:]=[-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00003,-0.00002,-0.00002,-0.00002,-0.00002,-0.00002,-0.00002,-0.00002,-0.00002,-0.00003,-0.00007,-0.00008,-0.00010,-0.00007,-0.00005]
thadv[1,:]=[-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00003,-0.00003,-0.00002,-0.00002,-0.00001,-0.00000,-0.00001,-0.00003,-0.00004,-0.00005,-0.00006,-0.00010,-0.00007,-0.00005]
thadv[2,:]=[-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00004,-0.00003,-0.00003,-0.00003,-0.00003,-0.00003,-0.00002,-0.00002,-0.00001,0.00000,-0.00001,-0.00002,-0.00005,-0.00003,-0.00004,-0.00011,-0.00008,-0.00005]
rvadv[0,:]=[-0.00000002,-0.00000002,-0.00000003,-0.00000003,-0.00000003,-0.00000003,-0.00000003,-0.00000003,-0.00000003,-0.00000003,-0.00000003,-0.00000003,-0.00000003,-0.00000003,-0.00000005,-0.00000006,-0.00000007,-0.00000008,-0.00000009,-0.00000007,-0.00000006,-0.00000000,0.00000000,-0.00000000]
rvadv[1,:]=[-0.00000004,-0.00000004,-0.00000004,-0.00000004,-0.00000004,-0.00000004,-0.00000004,-0.00000004,-0.00000003,-0.00000003,-0.00000003,-0.00000003,-0.00000002,-0.00000002,-0.00000002,-0.00000002,-0.00000001,-0.00000001,-0.00000002,-0.00000005,-0.00000002,0.00000004,0.00000001,0.00000000]
rvadv[2,:]=[-0.00000002,-0.00000002,-0.00000002,-0.00000002,-0.00000002,-0.00000002,-0.00000002,-0.00000002,-0.00000002,-0.00000001,-0.00000001,-0.00000001,-0.00000001,-0.00000000,0.00000000,0.00000001,0.00000002,0.00000006,0.00000008,-0.00000002,-0.00000005,-0.00000001,0.00000001,0.00000000]


case.add_variable('ug',ug,time=timeF,lev=zforc,levtype='altitude')

case.add_variable('vg',vg,time=timeF,lev=zforc,levtype='altitude')

case.add_variable('w',w,time=timeF,lev=zforc,levtype='altitude')

case.add_variable('theta_adv',thadv,time=timeF,lev=zforc,levtype='altitude')

case.add_variable('rv_adv',rvadv,time=timeF,lev=zforc,levtype='altitude')

# Surface Forcing

XTIMEF = np.zeros(24+1)
XSFTH = np.zeros(24+1)
XSFTQ = np.zeros(24+1)

XTIMEF[1]=0.
XTIMEF[2]=3600.
XTIMEF[3]=7200.
XTIMEF[4]=10800.
XTIMEF[5]=14400.
XTIMEF[6]=18000.
XTIMEF[7]=21600.
XTIMEF[8]=25200.
XTIMEF[9]=28800.
XTIMEF[10]=32400.
XTIMEF[11]=36000.
XTIMEF[12]=39600.
XTIMEF[13]=43200.
XTIMEF[14]=46800.
XTIMEF[15]=50400.
XTIMEF[16]=54000.
XTIMEF[17]=57600.
XTIMEF[18]=61200.
XTIMEF[19]=64800.
XTIMEF[20]=68400.
XTIMEF[21]=72000.
XTIMEF[22]=75600.
XTIMEF[23]=79200.
XTIMEF[24]=82800.
XSFTH[1]=5.0
XSFTH[2]=35.0
XSFTH[3]=80.0
XSFTH[4]=126.0
XSFTH[5]=149.0
XSFTH[6]=172.0
XSFTH[7]=197.0
XSFTH[8]=214.0
XSFTH[9]=203.0
XSFTH[10]=188.0
XSFTH[11]=150.0
XSFTH[12]=87.0
XSFTH[13]=31.0
XSFTH[14]=6.0
XSFTH[15]=-5.0
XSFTH[16]=-10.0
XSFTH[17]=-4.0
XSFTH[18]=-2.0
XSFTH[19]=-13.0
XSFTH[20]=-14.0
XSFTH[21]=-7.0
XSFTH[22]=-11.0
XSFTH[23]=-13.0
XSFTH[24]=-4.0
XSFTQ[1]=22.00
XSFTQ[2]=64.00
XSFTQ[3]=87.5
XSFTQ[4]=113.0
XSFTQ[5]=135.0
XSFTQ[6]=153.0
XSFTQ[7]=168.0
XSFTQ[8]=179.0
XSFTQ[9]=166.0
XSFTQ[10]=149.0
XSFTQ[11]=128.0
XSFTQ[12]=83.0
XSFTQ[13]=50.0
XSFTQ[14]=30.0
XSFTQ[15]=32.0
XSFTQ[16]=16.
XSFTQ[17]=0.0
XSFTQ[18]=0.0
XSFTQ[19]=2.0
XSFTQ[20]=3.0
XSFTQ[21]=0.0
XSFTQ[22]=0.0
XSFTQ[23]=0.0
XSFTQ[24]=0.0

case.add_variable('sfc_sens_flx',XSFTH[1:],time=XTIMEF[1:])
case.add_variable('sfc_lat_flx', XSFTQ[1:],time=XTIMEF[1:])


################################################
# 4. Attributes
################################################

# advection of theta and rv
case.set_attribute("adv_theta",1)
case.set_attribute("adv_rv",1)
# potential temperature radiative tendency is included in advection
case.set_attribute("rad_theta","adv")
# Geostrophic wind forcing
case.set_attribute("forc_geo",1)
# Vertical velocity
case.set_attribute("forc_w",1)
# Surface flux forcing, wind stress is computed using z0
case.set_attribute("surfaceType","land")
case.set_attribute("surfaceForcing","surfaceFlux")
case.set_attribute("surfaceForcingWind","z0")

################################################
# 5. Writing file
################################################

case.write('IHOP_REF_DEF_driver.nc',verbose=False)

if lverbose:
    case.info()

################################################
# 6. Ploting, if asked
################################################

if lplot:
    case.plot(rep_images='./images/driver_DEF/',timeunits='hours')
